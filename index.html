<!doctype html>
<html lang="fi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FallenCraft — Minecraft & Discord Palvelin</title>
<style>
  :root{
    --bg-dark:#0f2417; /* header dark */
    --panel-dark:#0e0e0e; /* main bg */
    --accent:#8fc96a; /* light green */
    --accent-dark:#6b8f4a;
    --card:#18321f; /* card bg */
    --muted:#bfe7a8;
    --shadow: 0 12px 20px rgba(0,0,0,0.6);
    font-family: "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  }
  html,body{height:100%;margin:0;background:var(--panel-dark);color:var(--muted);}
  header{
    background:linear-gradient(180deg, var(--bg-dark) 0%, #163622 100%);
    border-bottom:4px solid var(--accent);
    padding:28px 16px;
    text-align:center;
  }
  .logo {
    width:128px;
    height:128px;
    margin:0 auto 8px;
    background-image: url('images/fallencraftlogo.png');
    background-size:contain;
    background-repeat:no-repeat;
    background-position:center;
  }
  header h1{
    margin:6px 0 0;
    color:var(--accent);
    font-weight:700;
    font-size:2rem;
    letter-spacing:0.02em;
  }
  nav{
    display:flex;
    justify-content:center;
    gap:28px;
    padding:12px 0;
    background:transparent;
  }
  nav a{
    color:var(--accent);
    text-decoration:none;
    padding:8px 12px;
    border-radius:6px;
    transition:all .15s ease;
  }
  nav a:hover{
    background:rgba(143,201,106,0.06);
    box-shadow:inset 0 0 12px rgba(0,0,0,.6);
  }
  main{
    max-width:1100px;
    margin:36px auto;
    padding:40px 28px;
    background:transparent;
  }
  .card{
    background:linear-gradient(180deg, rgba(24,50,31,0.9), rgba(16,40,24,0.85));
    border-radius:12px;
    padding:28px;
    border:1px solid rgba(143,201,106,0.06);
    box-shadow:var(--shadow);
    margin-bottom:22px;
  }
  .center{text-align:center}
  h2{
    color:var(--accent);
    margin:6px 0 10px;
  }
  p.lead{
    color:#cfeec0;
    margin:0 0 22px;
  }
  .links{
    display:flex;
    justify-content:center;
    gap:18px;
    margin-top:18px;
  }
  .btn{
    display:inline-block;
    padding:18px 36px;
    border-radius:12px;
    background:var(--card);
    color:var(--accent);
    text-decoration:none;
    font-weight:600;
    box-shadow:0 8px 20px rgba(0,0,0,.6);
    border:1px solid rgba(143,201,106,0.04);
  }
  .servers-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
    gap:18px;
    margin-top:18px;
  }
  .server{
    background:rgba(0,0,0,0.25);
    padding:16px;
    border-radius:10px;
    border:1px solid rgba(143,201,106,0.04);
    display:flex;
    flex-direction:column;
    gap:8px;
    min-height:120px;
  }
  .server h3{
    margin:0;
    color:var(--accent-dark);
  }
  .meta{
    font-size:0.9rem;
    color:#cfeec0;
  }
  .status{
    margin-top:auto;
    font-weight:700;
    padding:8px 12px;
    border-radius:8px;
    display:inline-block;
  }
  .online{
    background:linear-gradient(90deg,#1b5d2b,#3ba14a);
    color:#072109;
  }
  .offline{
    background:linear-gradient(90deg,#3a2a2a,#222);
    color:#8a8a8a;
  }
  footer{
    border-top:4px solid var(--accent);
    padding:14px 0;
    text-align:center;
    margin-top:36px;
    background:var(--bg-dark);
    color:var(--accent);
    position:relative;
  }
  .small{
    font-size:0.9rem;
    color:#bfe7a8;
  }
  .muted{
    color:#9fbf95;
    font-size:0.95rem;
  }
  .help-note{
    margin-top:10px;
    font-size:0.95rem;
    color:#cfeec0;
  }
  /* responsive */
  @media (max-width:640px){
    header h1{font-size:1.4rem;}
    .btn{padding:12px 18px;}
    .logo{width:88px;height:88px;}
  }
</style>
</head>
<body>
<header>
  <div class="logo" aria-hidden="true"></div>
  <h1>Minecraft & Discord Palvelin</h1>
</header>

<main>
  <section class="card center" id="intro">
    <h2>Tervetuloa FallenCraftiin!</h2>
    <p class="lead">FallenCraft on yhteisö, jossa pelataan Minecraftia ja jutellaan Discordissa. Täältä löydät palvelimet, säännöt ja ylläpidon tiedot. Liity <a href="discord.html" class="muted">Discordiin</a> tai selaa palvelinlistaa alta.</p>

    <div class="links">
      <a class="btn" href="rules.html">Säännöt</a>
      <a class="btn" href="staff.html">Ylläpitäjät</a>
      <a class="btn" href="discord.html">Discord</a>
    </div>
  </section>

  <section class="card" id="servers">
    <h2>Ajankohtaiset Minecraft-palvelimet</h2>
    <p class="muted">Täältä näet käytössämme olevat palvelimet ja niiden tilan. Lisäksi ohje miten pyytää ylläpitoa käynnistämään palvelin.</p>

    <div class="servers-grid" id="serversGrid">
      <!-- Serverit generoidaan JS:llä -->
      <div class="server">
        <h3>esimerkki.fallen.fi</h3>
        <div class="meta">Mode: Survival • Portti: 25565</div>
        <div class="meta">Pelaajat: —</div>
        <div class="status offline">Tarkistetaan...</div>
      </div>
    </div>

    <p class="help-note">Tarvitsetko ylläpitoa käynnistämään palvelimen? Avaa tukipyyntö Discordin <strong>#apulipuke</strong>-kanavalla ja kerro:
      palvelimen nimi &nbsp;•&nbsp; miksi haluat sen käynnistettävän &nbsp;•&nbsp; kuinka nopeasti. Ylläpito voi tarvittaessa avata palvelimen, jos pyyntö hyväksytään.</p>
  </section>

  <section class="card" id="howto">
    <h2>Miten tracker toimii</h2>
    <p class="muted">Palvelintilan tarkistus hakee tiedot suoraan julkisesta Minecraft-serveri-API:sta. Jos palvelin on offline tai API ei vastaa, näyttää tämä sivu sen offline-tilana. Voit päivittää tilan manuaalisesti painamalla sivun uudelleenlatausta.</p>
  </section>
</main>

<footer>
  <div>© 2025 FallenCraft — Minecraft & Discord Palvelin</div>
</footer>

<script>
const SERVER_LIST = [
  { name: "Fallen Survival", host: "2fallencraft0.aternos.me", port: 12802, note: "Survival, PVP rajoitettu" },
  { name: "Fallen Prison", host: "23.27.139.44", port: 25929, note: "Grindaus, Tarina." },
  { name: "Fallen Events", host: "TULOSSAPIAN", port: 25567, note: "TULOSSA PIAN" }
];

// Tilalukko estämään päällekkäiset päivitykset
let isRefreshing = false;

function makeServerCard(srv){
  const wrap = document.createElement('div');
  wrap.className = 'server';
  wrap.innerHTML = `
    <h3>${escapeHtml(srv.name)}</h3>
    <div class="meta">${escapeHtml(srv.host)}:${escapeHtml(srv.port)} • ${escapeHtml(srv.note || '')}</div>
    <div class="meta players">Pelaajat: <span class="playersCount">-</span></div>
    <div class="status statusTag offline">Tarkistetaan...</div>
  `;
  return wrap;
}

// Escape HTML safe text for insertion
function escapeHtml(text){
  return String(text).replace(/[&<>"']/g, function(m){
    return {
      '&':'&amp;',
      '<':'&lt;',
      '>':'&gt;',
      '"':'&quot;',
      "'":'&#39;'
    }[m];
  });
}

async function fetchServerStatus(host, port){
  try {
    // API kutsu
    const url = `https://api.mcsrvstat.us/2/${host}:${port}`;
    const res = await fetch(url);
    if(!res.ok) throw new Error('HTTP error ' + res.status);
    const data = await res.json();
    return data;
  } catch(e) {
    return null;
  }
}

async function refreshServers(){
  if(isRefreshing) return;
  isRefreshing = true;

  const container = document.getElementById('serversGrid');
  container.innerHTML = ''; // Tyhjennä aiemmat

  for(const srv of SERVER_LIST){
    const card = makeServerCard(srv);
    container.appendChild(card);

    // Haetaan tila
    const statusDiv = card.querySelector('.statusTag');
    const playersSpan = card.querySelector('.playersCount');

    if(srv.note === "TULOSSAPIAN"){
      // Jos palvelin on tulossa pian, näytetään aina offline-teksti
      statusDiv.textContent = "Tulossa pian";
      statusDiv.className = "status offline";
      playersSpan.textContent = "—";
      continue;
    }

    const data = await fetchServerStatus(srv.host, srv.port);

    if(data && data.online){
      statusDiv.textContent = "Online";
      statusDiv.className = "status online";
      playersSpan.textContent = `${data.players.online} / ${data.players.max}`;
    } else {
      statusDiv.textContent = "Offline";
      statusDiv.className = "status offline";
      playersSpan.textContent = "—";
    }
  }

  isRefreshing = false;
}

// Automaattinen päivitys 5 minuutin välein
refreshServers();
setInterval(refreshServers, 5 * 60 * 1000);
</script>
</body>
</html>
